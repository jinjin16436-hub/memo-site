<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¶€ê´‘ê³  1-1 ìˆ™ì œ & ìˆ˜í–‰í‰ê°€</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="topbar">
  <h1>ğŸ“’ ìˆ™ì œ & ìˆ˜í–‰í‰ê°€</h1>
  <div class="auth-area">
    <button id="adminBadge" class="badge admin" style="display:none">ê´€ë¦¬ì</button>
    <button id="loginBtn"  class="btn">ğŸ”‘ ë¡œê·¸ì¸</button>
    <button id="logoutBtn" class="btn" style="display:none">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<main class="container">

  <!-- ì¤‘ìš” ì „ë‹¬ ì‚¬í•­ -->
  <section class="panel">
    <div class="panel-head">
      <h2>ğŸ“£ ì¤‘ìš” ì „ë‹¬ ì‚¬í•­</h2>
      <label class="switch" title="í‘œì‹œ/ìˆ¨ê¹€(ê´€ë¦¬ìë§Œ)">
        <input type="checkbox" id="noticeToggle" />
        <span class="slider"></span>
      </label>
    </div>

    <div id="noticeWrap" class="notice-wrap">
      <p class="muted">ë“±ë¡ëœ ì „ë‹¬ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>

    <div id="noticeEditor" class="notice-editor" style="display:none">
      <div class="row">
        <input id="noticeTitle" class="input" placeholder="ì œëª©" />
        <select id="noticeTone" class="select">
          <option value="yellow">ì „ë‹¬ ì‚¬í•­</option>
          <option value="orange">ì£¼ì˜</option>
          <option value="red">ê¸´ê¸‰</option>
          <option value="green">ì•ˆë‚´</option>
          <option value="blue">ì •ë³´</option>
        </select>
        <button id="noticeAdd" class="btn add">+ ì¶”ê°€</button>
      </div>
      <textarea id="noticeBody" class="textarea" placeholder="ë‚´ìš© (ì¤„ë°”ê¿ˆ ê°€ëŠ¥)"></textarea>
    </div>
  </section>

  <!-- ì‹œí—˜ -->
  <section class="panel">
    <div class="panel-head"><h2>ğŸ§ª ì‹œí—˜</h2></div>
    <ul id="list_exam" class="task-list"></ul>
    <div class="add-row" data-cat="exam">
      <div class="grid">
        <input class="subj input" placeholder="ê³¼ëª©" />
        <input class="text input" placeholder="ë‚´ìš©" />
        <input class="dateStart input" type="date" />
        <input class="dateEnd input" type="date" />
        <select class="startPeriod select">
          <option value="">ì‹œì‘ êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <select class="endPeriod select">
          <option value="">ë êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <button class="add btn">+ ì¶”ê°€</button>
      </div>
      <textarea class="detail textarea" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
    </div>
  </section>

  <!-- ìˆ˜í–‰í‰ê°€ -->
  <section class="panel">
    <div class="panel-head"><h2>ğŸ§¾ ìˆ˜í–‰í‰ê°€</h2></div>
    <ul id="list_perf" class="task-list"></ul>
    <div class="add-row" data-cat="perf">
      <div class="grid">
        <input class="subj input" placeholder="ê³¼ëª©" />
        <input class="text input" placeholder="ë‚´ìš©" />
        <input class="dateStart input" type="date" />
        <input class="dateEnd input" type="date" />
        <select class="startPeriod select">
          <option value="">ì‹œì‘ êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <select class="endPeriod select">
          <option value="">ë êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <button class="add btn">+ ì¶”ê°€</button>
      </div>
      <textarea class="detail textarea" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
    </div>
  </section>

  <!-- ìˆ™ì œ -->
  <section class="panel">
    <div class="panel-head"><h2>ğŸ“Œ ìˆ™ì œ</h2></div>
    <ul id="list_home" class="task-list"></ul>
    <div class="add-row" data-cat="home">
      <div class="grid">
        <input class="subj input" placeholder="ê³¼ëª©" />
        <input class="text input" placeholder="ë‚´ìš©" />
        <input class="dateStart input" type="date" />
        <input class="dateEnd input" type="date" />
        <select class="startPeriod select">
          <option value="">ì‹œì‘ êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <select class="endPeriod select">
          <option value="">ë êµì‹œ</option>
          <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
          <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
          <option>7êµì‹œ</option><option>8êµì‹œ</option>
        </select>
        <button class="add btn">+ ì¶”ê°€</button>
      </div>
      <textarea class="detail textarea" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
    </div>
  </section>

</main>

<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal" style="display:none">
  <div class="modal-body">
    <h3>í•­ëª© ìˆ˜ì •</h3>
    <div class="grid">
      <input id="editSubj"  class="input" />
      <input id="editText"  class="input" />
      <input id="editStart" class="input" type="date" />
      <input id="editEnd"   class="input" type="date" />
      <select id="editStartPeriod" class="select">
        <option value="">ì‹œì‘ êµì‹œ</option>
        <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
        <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
        <option>7êµì‹œ</option><option>8êµì‹œ</option>
      </select>
      <select id="editEndPeriod" class="select">
        <option value="">ë êµì‹œ</option>
        <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
        <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option>
        <option>7êµì‹œ</option><option>8êµì‹œ</option>
      </select>
    </div>
    <textarea id="editDetail" class="textarea" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>

    <div class="right">
      <button id="editCancel" class="btn light">ì·¨ì†Œ</button>
      <button id="editSave"   class="btn">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- Firebase compat SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ========= 1) Firebase ì„¤ì • ========= */
const firebaseConfig = {
  apiKey: "AIzaSyBbThwhLWHJz8mBHGvhpWOL88cP9C7Nxio",
  authDomain: "my-memo-site.firebaseapp.com",
  projectId: "my-memo-site",
  storageBucket: "my-memo-site.firebasestorage.app",
  messagingSenderId: "196036694705",
  appId: "1:196036694705:web:8988d12919420130464890"
};
// ë°˜ë“œì‹œ ë³¸ì¸ ê°’ìœ¼ë¡œ êµì²´
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.firestore();

/* ========= 2) ê³ ì • UID ========= */
// ê´€ë¦¬ì UIDì™€ ê³µê°œ ì½ê¸°ìš© UID
const ADMIN_UID  = "vv0bADtWdqQUnqFMy8k01dhO13t2";      // ê´€ë¦¬ì ê³„ì • uid
const PUBLIC_UID = "vv0bADtWdqQUnqFMy8k01dhO13t2"; // ë¹„ë¡œê·¸ì¸/ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ë°ì´í„°ì˜ uid

/* ========= 3) ì „ì—­ ìƒíƒœ ========= */
let currentUser = null;
let isAdmin     = false;
const lists = { exam: document.getElementById('list_exam'),
                perf: document.getElementById('list_perf'),
                home: document.getElementById('list_home') };

let unsub = []; // snapshot í•´ì œ

/* ========= 4) ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ========= */
document.getElementById('loginBtn').onclick = async () => {
  try {
    await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
    await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
  } catch(e) { alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message); }
};
document.getElementById('logoutBtn').onclick = () => auth.signOut();

auth.onAuthStateChanged(user => {
  currentUser = user;
  isAdmin     = !!(user && user.uid === ADMIN_UID);

  document.getElementById('loginBtn').style.display  = user ? "none" : "";
  document.getElementById('logoutBtn').style.display = user ? "" : "none";
  document.getElementById('adminBadge').style.display = isAdmin ? "" : "none";

  // ê´€ë¦¬ìë§Œ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ UI ë…¸ì¶œ
  document.querySelectorAll('.add-row').forEach(r => r.style.display = isAdmin ? "" : "none");
  document.getElementById('noticeEditor').style.display = isAdmin ? "" : "none";
  document.querySelectorAll('.task-list .op').forEach(btn => btn.style.display = isAdmin ? "" : "none");

  bindDraft(); // í¼ ìë™ì €ì¥
  startListeners(); // ëª©ë¡ ìŠ¤ëƒ…ìƒ·

  // ì¤‘ìš” ì „ë‹¬ ì‚¬í•­ í† ê¸€ ê´€ë¦¬
  loadNoticeToggle();
});

/* ========= 5) ê²½ë¡œ ìœ í‹¸ ========= */
function ownerUidForRead() {
  return (currentUser && isAdmin) ? ADMIN_UID : PUBLIC_UID;
}
function ownerUidForWrite() {
  if (!currentUser || !isAdmin) throw new Error("ê¶Œí•œ ì—†ìŒ");
  return ADMIN_UID;
}
function col(cat, write=false) {
  const uid = write ? ownerUidForWrite() : ownerUidForRead();
  return db.collection("users").doc(uid).collection("tasks").doc(cat).collection("items");
}

/* ========= 6) D-day ê³„ì‚° ========= */
function renderDday(startStr, endStr) {
  if (!startStr) return '';
  const msDay = 86400000;
  const today = new Date(); today.setHours(0,0,0,0);

  const start = new Date(startStr); start.setHours(0,0,0,0);
  const end   = endStr ? new Date(endStr) : new Date(startStr);
  end.setHours(0,0,0,0);

  if (today < start) {
    const diff = Math.ceil((start - today)/msDay);
    return `<span class="dday pill warn">D-${diff}</span>`;
  } else if (today >= start && today <= end) {
    return `<span class="dday pill hot">D-DAY</span>`;
  } else {
    const diff = Math.ceil((today - end)/msDay);
    return `<span class="dday pill thin">D+${diff}</span>`;
  }
}

/* ========= 7) ë Œë” ========= */
function periodRange(s,e){
  if(!s && !e) return "";
  if(s && !e) return ` ${s}`;
  if(!s && e) return ` ${e}`;
  return ` ${s} ~ ${e}`;
}

function renderOne(cat, it) {
  const dday = renderDday(it.startDate, it.endDate);
  const pr   = periodRange(it.startPeriod || "", it.endPeriod || "");

  return `
  <li class="task" data-cat="${cat}" data-id="${it.id}">
    <label class="chk-wrap">
      <input type="checkbox" ${it.done?"checked":""} disabled />
      <span></span>
    </label>
    <div class="task__main">
      <div class="task__line">
        <div class="topline">
          <b class="subject">${escapeHtml(it.subj||"")}</b>
          ${dday}
        </div>
        <div class="content">${escapeHtml(it.text||"")}</div>
      </div>
      <div class="task__meta">
        <span>ğŸ“… ${it.startDate || ""}${it.endDate? ` ~ ${it.endDate}`:""}${pr? ` Â·${pr}`:""}</span>
      </div>
      ${it.detail? `<pre class="detail">${escapeHtml(it.detail)}</pre>` : ""}
    </div>
    <div class="task__ops">
      <button class="op btn light" data-act="edit"  style="display:${isAdmin?'':'none'}">ìˆ˜ì •</button>
      <button class="op btn light" data-act="del"   style="display:${isAdmin?'':'none'}">ì‚­ì œ</button>
    </div>
  </li>`;
}

function renderList(cat, items) {
  const ul = lists[cat];
  ul.innerHTML = items.map(it => renderOne(cat,it)).join("");

  // ìˆ˜ì •/ì‚­ì œ ë°”ì¸ë”©
  ul.querySelectorAll("[data-act]").forEach(btn=>{
    btn.onclick = async (e)=>{
      const li = e.target.closest("li.task");
      const id = li.dataset.id;
      const act = e.target.dataset.act;

      if(act==="del"){
        if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
        try{
          await col(cat,true).doc(id).delete();
        }catch(err){ alert("ì‚­ì œ ì‹¤íŒ¨: " + err.message); }
      }else if(act==="edit"){
        openEdit(cat,id);
      }
    };
  });
}

/* ========= 8) ìŠ¤ëƒ…ìƒ· ========= */
function startListeners(){
  unsub.forEach(u=>u&&u()); unsub = [];
  ["exam","perf","home"].forEach(cat=>{
    const u = col(cat).orderBy("startDate","asc").onSnapshot(snap=>{
      const arr=[]; snap.forEach(d=>arr.push({id:d.id, ...d.data()}));
      renderList(cat,arr);
    }, err=>{
      console.error("listener error:",err);
    });
    unsub.push(u);
  });

  // ì „ë‹¬ ì‚¬í•­ ë¡œë“œ
  loadNotices();
}

// 60ì´ˆë§ˆë‹¤ ì¡°ìš©í•œ ê°±ì‹ (ë‹¨, onSnapshotê°€ ìˆì–´ ì‚¬ì‹¤ìƒ ë¶ˆí•„ìš”í•˜ì§€ë§Œ ìš”ì²­ì´ ìˆì–´ ë‘¡ë‹ˆë‹¤)
setInterval(()=>startListeners(), 60000);

/* ========= 9) ì¶”ê°€ í¼(+ ìë™ ì„ì‹œ ì €ì¥) ========= */
const DRAFT_KEY = "memo:draft-v2";

function gatherDraft(){
  const data={};
  document.querySelectorAll(".add-row").forEach(row=>{
    const cat=row.dataset.cat;
    data[cat] = {
      subj:  row.querySelector(".subj").value,
      text:  row.querySelector(".text").value,
      start: row.querySelector(".dateStart").value,
      end:   row.querySelector(".dateEnd").value,
      sp:    row.querySelector(".startPeriod").value,
      ep:    row.querySelector(".endPeriod").value,
      detail:row.querySelector(".detail").value
    };
  });
  return data;
}
function applyDraft(data){
  if(!data) return;
  document.querySelectorAll(".add-row").forEach(row=>{
    const d = data[row.dataset.cat]; if(!d) return;
    row.querySelector(".subj").value  = d.subj || "";
    row.querySelector(".text").value  = d.text || "";
    row.querySelector(".dateStart").value = d.start || "";
    row.querySelector(".dateEnd").value   = d.end   || "";
    row.querySelector(".startPeriod").value = d.sp || "";
    row.querySelector(".endPeriod").value   = d.ep || "";
    row.querySelector(".detail").value = d.detail || "";
  });
}
function bindDraft(){
  try{ applyDraft(JSON.parse(localStorage.getItem(DRAFT_KEY))); }catch{}
  document.addEventListener("input", e=>{
    if(e.target.closest(".add-row")){
      localStorage.setItem(DRAFT_KEY, JSON.stringify(gatherDraft()));
    }
  });
}
function clearRow(row){
  row.querySelector(".subj").value="";
  row.querySelector(".text").value="";
  row.querySelector(".dateStart").value="";
  row.querySelector(".dateEnd").value="";
  row.querySelector(".startPeriod").value="";
  row.querySelector(".endPeriod").value="";
  row.querySelector(".detail").value="";
  localStorage.setItem(DRAFT_KEY, JSON.stringify(gatherDraft()));
}

// ì¶”ê°€ ë²„íŠ¼ ë°”ì¸ë”©
document.querySelectorAll(".add-row .add").forEach(btn=>{
  btn.onclick = async ()=>{
    if(!isAdmin){ alert("ê´€ë¦¬ìë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; }
    const row = btn.closest(".add-row");
    const cat = row.dataset.cat;

    const subj  = row.querySelector(".subj").value.trim();
    const text  = row.querySelector(".text").value.trim();
    const start = row.querySelector(".dateStart").value;
    const end   = row.querySelector(".dateEnd").value;
    const sp    = row.querySelector(".startPeriod").value;
    const ep    = row.querySelector(".endPeriod").value;
    const detail= row.querySelector(".detail").value;

    if(!subj || !text || !start){ alert("ê³¼ëª©/ë‚´ìš©/ì‹œì‘ì¼ì€ í•„ìˆ˜ì…ë‹ˆë‹¤."); return; }

    try{
      await col(cat,true).add({
        subj, text, startDate:start, endDate:end || start,
        startPeriod: sp || "", endPeriod: ep || "",
        detail: detail || "",
        done:false,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      clearRow(row);
    }catch(err){ alert("ì €ì¥ ì‹¤íŒ¨: " + err.message); }
  };
});

/* ========= 10) ìˆ˜ì • ëª¨ë‹¬ ========= */
const modal = document.getElementById("editModal");
const editSubj = document.getElementById("editSubj");
const editText = document.getElementById("editText");
const editStart= document.getElementById("editStart");
const editEnd  = document.getElementById("editEnd");
const editStartPeriod = document.getElementById("editStartPeriod");
const editEndPeriod   = document.getElementById("editEndPeriod");
const editDetail = document.getElementById("editDetail");

let editing = { cat:null, id:null };

function openEdit(cat,id){
  editing = {cat,id};
  col(cat).doc(id).get().then(doc=>{
    const d=doc.data();
    editSubj.value  = d.subj||"";
    editText.value  = d.text||"";
    editStart.value = d.startDate||"";
    editEnd.value   = d.endDate||"";
    editStartPeriod.value = d.startPeriod||"";
    editEndPeriod.value   = d.endPeriod||"";
    editDetail.value = d.detail||"";
    modal.style.display="block";
  });
}
document.getElementById("editCancel").onclick = ()=> modal.style.display="none";
document.getElementById("editSave").onclick = async ()=>{
  if(!isAdmin){ alert("ê´€ë¦¬ìë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; }
  try{
    await col(editing.cat,true).doc(editing.id).update({
      subj: editSubj.value.trim(),
      text: editText.value.trim(),
      startDate: editStart.value,
      endDate:   editEnd.value || editStart.value,
      startPeriod: editStartPeriod.value || "",
      endPeriod:   editEndPeriod.value   || "",
      detail: editDetail.value || ""
    });
    modal.style.display="none";
  }catch(err){ alert("ìˆ˜ì • ì‹¤íŒ¨: " + err.message); }
};

/* ========= 11) ì¤‘ìš” ì „ë‹¬ ì‚¬í•­ ========= */
// êµ¬ì¡°: settings/{ADMIN_UID}/doc("ui")-> { showNotices: boolean }
// ê³µì§€ ì»¬ë ‰ì…˜: users/{ADMIN_UID}/notices/{autoId} -> { title, body, tone, createdAt }

const uiDoc = db.collection("settings").doc(ADMIN_UID).collection("ui").doc("global");

async function loadNoticeToggle(){
  const tgl = document.getElementById("noticeToggle");
  try{
    const s = await uiDoc.get();
    const show = !!(s.exists && s.data().showNotices);
    tgl.checked = show;
  }catch{}
  // ê´€ë¦¬ìë§Œ í† ê¸€ ê°€ëŠ¥
  tgl.disabled = !isAdmin;
  tgl.onchange = async ()=>{
    if(!isAdmin) return;
    try{
      await uiDoc.set({ showNotices: tgl.checked }, { merge:true });
    }catch(e){ alert("í‘œì‹œ ì„¤ì • ì‹¤íŒ¨: "+e.message); }
  };
}

function loadNotices(){
  // í‘œì‹œ ì„¤ì •ì— ë”°ë¼ ìˆ¨ê¹€ ì²˜ë¦¬
  uiDoc.get().then(s=>{
    const show = !!(s.exists && s.data().showNotices);
    document.querySelector(".panel .notice-wrap").style.opacity = show? "1" : "0.45";
  });
  // ëª©ë¡
  db.collection("users").doc(ownerUidForRead()).collection("notices")
    .orderBy("createdAt","desc")
    .onSnapshot(snap=>{
      const wrap = document.getElementById("noticeWrap");
      if(snap.empty){ wrap.innerHTML = '<p class="muted">ë“±ë¡ëœ ì „ë‹¬ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
      const html = [];
      snap.forEach(d=>{
        const n=d.data();
        const color = n.tone||"yellow";
        html.push(`
          <article class="notice ${color}">
            <div class="notice-title">${escapeHtml(n.title||"")}</div>
            <pre class="notice-body">${escapeHtml(n.body||"")}</pre>
          </article>
        `);
      });
      wrap.innerHTML = html.join("");
    }, err=>console.error(err));
}

document.getElementById("noticeAdd").onclick = async ()=>{
  if(!isAdmin){ alert("ê´€ë¦¬ìë§Œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; }
  const title = document.getElementById("noticeTitle").value.trim();
  const body  = document.getElementById("noticeBody").value.trim();
  const tone  = document.getElementById("noticeTone").value;
  if(!title){ alert("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
  try{
    await db.collection("users").doc(ownerUidForWrite()).collection("notices").add({
      title, body, tone, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById("noticeTitle").value="";
    document.getElementById("noticeBody").value="";
  }catch(e){ alert("ì¶”ê°€ ì‹¤íŒ¨: " + e.message); }
};

/* ========= 12) ë„ìš°ë¯¸ ========= */
function escapeHtml(s){ return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

</script>
</body>
</html>
