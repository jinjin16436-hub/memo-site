<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ë¶€ê´‘ê³  1-1 ìˆ™ì œ & ìˆ˜í–‰í‰ê°€</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="admin-bar">
    <h1>ğŸ“’ ìˆ™ì œ & ìˆ˜í–‰í‰ê°€</h1>
    <div class="auth">
      <button id="loginBtn" class="btn">ğŸ”‘ Google ë¡œê·¸ì¸</button>
      <button id="logoutBtn" class="btn" style="display:none">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
      <span id="adminBadge" class="admin-badge" style="display:none;">ê´€ë¦¬ì</span>
    </div>
  </header>

  <main class="container">

    <!-- ========== ì¤‘ìš” ì „ë‹¬ ì‚¬í•­ ========== -->
    <section class="block">
      <div class="block-head">
        <h2>ğŸ“¢ ì¤‘ìš” ì „ë‹¬ ì‚¬í•­</h2>
        <label class="switch" title="ê´€ë¦¬ìë§Œ ë³€ê²½ ê°€ëŠ¥">
          <input type="checkbox" id="noticeToggle" />
          <span class="slider"></span>
        </label>
      </div>

      <!-- ê´€ë¦¬ì ì „ìš© ì…ë ¥ í¼ -->
      <div id="noticeForm" class="notice-form" style="display:none">
        <div class="row row-1">
          <input id="noticeTitle" class="input" placeholder="ì œëª©" />
          <select id="noticeLevel" class="input select">
            <option value="ì•Œë¦¼">ì „ë‹¬ ì‚¬í•­</option>
            <option value="ì£¼ì˜">ì£¼ì˜</option>
            <option value="ê¸´ê¸‰">ê¸´ê¸‰</option>
          </select>
          <button id="noticeAddBtn" class="btn primary">+ ì¶”ê°€</button>
        </div>
        <div class="row row-2">
          <textarea id="noticeBody" class="input" rows="3" placeholder="ìƒì„¸ ë‚´ìš© (ì¤„ë°”ê¿ˆ ê°€ëŠ¥)"></textarea>
        </div>
      </div>

      <ul id="noticeList" class="list"></ul>
      <div id="noticeEmpty" class="empty">ë“±ë¡ëœ ì „ë‹¬ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

    <!-- ========== ì‹œí—˜ ========== -->
    <section class="block" id="sec-exam">
      <div class="block-head">
        <h2>ğŸ§ª ì‹œí—˜</h2>
      </div>
      <div class="task-form" id="form-exam" style="display:none">
        <div class="row row-1">
          <input class="input subj" placeholder="ê³¼ëª©" />
          <input class="input text" placeholder="ë‚´ìš©" />
          <input type="date" class="input start" />
          <input type="date" class="input end" />
          <div class="select-wrap">
            <select class="input select startp">
              <option value="">ì‹œì‘ êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <div class="select-wrap">
            <select class="input select endp">
              <option value="">ë êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <button class="btn primary add">+ ì¶”ê°€</button>
        </div>
        <div class="row row-2">
          <textarea class="input detail" rows="3" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
        </div>
      </div>
      <ul id="list-exam" class="list"></ul>
      <div class="empty" id="empty-exam">ë“±ë¡ëœ ì‹œí—˜ì´ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

    <!-- ========== ìˆ˜í–‰í‰ê°€ ========== -->
    <section class="block" id="sec-perf">
      <div class="block-head">
        <h2>ğŸ“ ìˆ˜í–‰í‰ê°€</h2>
      </div>
      <div class="task-form" id="form-perf" style="display:none">
        <div class="row row-1">
          <input class="input subj" placeholder="ê³¼ëª©" />
          <input class="input text" placeholder="ë‚´ìš©" />
          <input type="date" class="input start" />
          <input type="date" class="input end" />
          <div class="select-wrap">
            <select class="input select startp">
              <option value="">ì‹œì‘ êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <div class="select-wrap">
            <select class="input select endp">
              <option value="">ë êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <button class="btn primary add">+ ì¶”ê°€</button>
        </div>
        <div class="row row-2">
          <textarea class="input detail" rows="3" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
        </div>
      </div>
      <ul id="list-perf" class="list"></ul>
      <div class="empty" id="empty-perf">ë“±ë¡ëœ ìˆ˜í–‰í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

    <!-- ========== ìˆ™ì œ ========== -->
    <section class="block" id="sec-home">
      <div class="block-head">
        <h2>ğŸ“Œ ìˆ™ì œ</h2>
      </div>
      <div class="task-form" id="form-home" style="display:none">
        <div class="row row-1">
          <input class="input subj" placeholder="ê³¼ëª©" />
          <input class="input text" placeholder="ë‚´ìš©" />
          <input type="date" class="input start" />
          <input type="date" class="input end" />
          <div class="select-wrap">
            <select class="input select startp">
              <option value="">ì‹œì‘ êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <div class="select-wrap">
            <select class="input select endp">
              <option value="">ë êµì‹œ</option>
              <option>1êµì‹œ</option><option>2êµì‹œ</option><option>3êµì‹œ</option>
              <option>4êµì‹œ</option><option>5êµì‹œ</option><option>6êµì‹œ</option><option>7êµì‹œ</option>
            </select>
          </div>
          <button class="btn primary add">+ ì¶”ê°€</button>
        </div>
        <div class="row row-2">
          <textarea class="input detail" rows="3" placeholder="ìƒì„¸ ë‚´ìš© (ì„ íƒ)"></textarea>
        </div>
      </div>
      <ul id="list-home" class="list"></ul>
      <div class="empty" id="empty-home">ë“±ë¡ëœ ìˆ™ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
    </section>

  </main>

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ---------- Firebase ----------
    const firebaseConfig = {
      apiKey: "AIzaSyBbThwhLWHJz8mBHGvhpWOL88cP9C7Nxio",
      authDomain: "my-memo-site.firebaseapp.com",
      projectId: "my-memo-site",
      storageBucket: "my-memo-site.firebasestorage.app",
      messagingSenderId: "196036694705",
      appId: "1:196036694705:web:8988d12919420130464890"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db   = firebase.firestore();

    // ---------- ìƒìˆ˜ (ë°˜ë“œì‹œ ë°”ê¾¸ê¸°) ----------
    const ADMIN_UID  = "vv0bADtWdqQUnqFMy8k01dhO13t2";
    const PUBLIC_UID = "vv0bADtWdqQUnqFMy8k01dhO13t2";

    // ---------- DOM ----------
    const $  = (q, root=document) => root.querySelector(q);
    const $$ = (q, root=document) => Array.from(root.querySelectorAll(q));

    const loginBtn   = $("#loginBtn");
    const logoutBtn  = $("#logoutBtn");
    const adminBadge = $("#adminBadge");

    const noticeToggle = $("#noticeToggle");
    const noticeForm   = $("#noticeForm");
    const noticeList   = $("#noticeList");
    const noticeEmpty  = $("#noticeEmpty");
    const noticeTitle  = $("#noticeTitle");
    const noticeLevel  = $("#noticeLevel");
    const noticeBody   = $("#noticeBody");
    const noticeAddBtn = $("#noticeAddBtn");

    const forms = {
      exam: $("#form-exam"),
      perf: $("#form-perf"),
      home: $("#form-home"),
    };
    const lists = {
      exam: $("#list-exam"),
      perf: $("#list-perf"),
      home: $("#list-home"),
    };
    const empties = {
      exam: $("#empty-exam"),
      perf: $("#empty-perf"),
      home: $("#empty-home"),
    };

    // ---------- ìƒíƒœ ----------
    let currentUser = null;
    let isAdmin = false;

    let unsub = { exam:null, perf:null, home:null };
    let noticeUnsub = null;
    let settingUnsub= null;

    // ---------- ìœ í‹¸ ----------
    function toast(m){ alert(m); }
    function esc(s){ return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }
    function ymd(d){ return d ? d.slice(0,10) : ""; }

    function todayStr(){
      const d = new Date();
      return d.toISOString().slice(0,10);
    }

    // D-day ë°°ì§€
    function dBadge(startStr, endStr){
      if(!startStr) return "";
      const now = new Date(todayStr());
      const start = new Date(startStr);
      const end = endStr ? new Date(endStr) : start;

      const ms = 1000*60*60*24;
      const diffStart = Math.floor((start - now)/ms); // ì‹œì‘ì¼ê¹Œì§€ ë‚¨ì€ ì¼ìˆ˜

      // ê¸°ê°„ ì¤‘
      if(now >= start && now <= end){
        return `<span class="dday inrange">D-Day</span>`;
      }

      // ì§€ë‚œ ì¼ì •
      if(now > end){
        return `<span class="dday past">A+${Math.abs(diffStart)}</span>`;
      }

      // ì•ìœ¼ë¡œ ë‚¨ì€ ì¼ì •
      let cls = "";
      if(diffStart <= 1) cls="red";         // D-1~0 ë¹¨
      else if(diffStart <= 3) cls="orange"; // D-3~2 ì£¼
      else if(diffStart <= 5) cls="yellow"; // D-5~4 ë…¸
      else cls="green";                     // D-6~ ì—°ë‘
      return `<span class="dday ${cls}">D-${diffStart}</span>`;
    }

    // í…ìŠ¤íŠ¸ - êµì‹œ
    function periodText(sp, ep){
      if(!sp && !ep) return "";
      if(sp && !ep) return sp;
      if(!sp && ep) return ep;
      return `${sp} ~ ${ep}`;
    }

    // ---------- ì¸ì¦ ----------
    loginBtn.onclick = async ()=>{
      await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
      await auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
    };
    logoutBtn.onclick = ()=>auth.signOut();

    function syncAdminUI(){
      isAdmin = !!(currentUser && currentUser.uid === ADMIN_UID);
      adminBadge.style.display = isAdmin ? "" : "none";
      loginBtn.style.display   = currentUser ? "none" : "";
      logoutBtn.style.display  = currentUser ? "" : "none";

      // ê³µì§€ ê¶Œí•œ
      noticeForm.style.display = isAdmin ? "" : "none";
      noticeToggle.disabled    = !isAdmin;
      noticeAddBtn.disabled    = !isAdmin;
      noticeAddBtn.style.pointerEvents = isAdmin ? "auto" : "none";

      // ì‘ì—… í¼
      Object.values(forms).forEach(f=>{
        f.style.display = isAdmin ? "" : "none";
      });
    }

    auth.onAuthStateChanged(u=>{
      currentUser = u || null;
      syncAdminUI();
      startNoticeListeners();
      startTaskListeners();
    });

    // ---------- ê³µì§€(í‘œì‹œ ì—¬ë¶€ + ëª©ë¡) ----------
    function startNoticeListeners(){
      if(settingUnsub) settingUnsub();
      settingUnsub = db.collection("settings").doc("notice").onSnapshot(snap=>{
        const data = snap.exists ? snap.data() : {enabled:true};
        noticeToggle.checked = !!data.enabled;
      });

      if(noticeUnsub) noticeUnsub();
      noticeUnsub = db.collection("notices").orderBy("createdAt","desc").onSnapshot(snap=>{
        const arr=[]; snap.forEach(d=>arr.push({id:d.id, ...d.data()}));
        renderNotices(arr);
      });
    }

    noticeToggle.addEventListener("change", async (e)=>{
      if(!isAdmin){
        const snap = await db.collection("settings").doc("notice").get();
        noticeToggle.checked = snap.exists ? !!snap.data().enabled : false;
        return toast("í‘œì‹œ ì—¬ë¶€ëŠ” ê´€ë¦¬ìë§Œ ë³€ê²½í•  ìˆ˜ ìˆì–´ìš”.");
      }
      await db.collection("settings").doc("notice").set({
        enabled: !!e.target.checked,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      },{merge:true});
    });

    function renderNotices(items){
      noticeList.innerHTML="";
      if(items.length===0){ noticeEmpty.style.display=""; return;}
      noticeEmpty.style.display="none";

      for(const it of items){
        const li = document.createElement("li");
        li.className="notice-item";
        li.innerHTML = `
          <div class="line">
            <b class="title">${esc(it.title||"")}</b>
            <span class="pill ${lvlCls(it.level)}">${it.level||"ì „ë‹¬ ì‚¬í•­"}</span>
          </div>
          <div class="body">${esc(it.body||"").replace(/\n/g,"<br>")}</div>
          <div class="actions" style="display:${isAdmin?'flex':'none'}">
            <button class="btn ghost" data-act="edit">ìˆ˜ì •</button>
            <button class="btn ghost danger" data-act="del">ì‚­ì œ</button>
          </div>`;
        li.addEventListener("click", async (e)=>{
          const act = e.target?.getAttribute?.("data-act");
          if(!act) return;
          if(!isAdmin) return toast("ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
          if(act==="del"){
            if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
            await db.collection("notices").doc(it.id).delete();
          }else{
            const t = prompt("ì œëª©", it.title||""); if(t===null) return;
            const b = prompt("ìƒì„¸ ë‚´ìš©", it.body||""); if(b===null) return;
            const l = prompt("ë ˆë²¨(ì „ë‹¬ ì‚¬í•­/ì£¼ì˜/ê¸´ê¸‰)", it.level||"ì „ë‹¬ ì‚¬í•­") || "ì „ë‹¬ ì‚¬í•­";
            await db.collection("notices").doc(it.id).set({
              title:t.trim(), body:b, level:l.trim(),
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },{merge:true});
          }
        });
        noticeList.appendChild(li);
      }
    }
    function lvlCls(lv){
      if(lv==="ê¸´ê¸‰") return "pill-red";
      if(lv==="ì£¼ì˜") return "pill-orange";
      return "pill-blue";
    }

    noticeAddBtn.addEventListener("click", async ()=>{
      if(!isAdmin) return toast("ê´€ë¦¬ìë§Œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.");
      const title=(noticeTitle.value||"").trim();
      const level=(noticeLevel.value||"ì „ë‹¬ ì‚¬í•­").trim();
      const body =(noticeBody.value||"").trim();
      if(!title){ noticeTitle.focus(); return; }
      await db.collection("notices").add({
        title, body, level,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        createdBy: currentUser?.uid || ADMIN_UID
      });
      // ì…ë ¥ê°’ ìœ ì§€ ì›í•˜ë©´ ì•„ë˜ ì£¼ì„
      noticeTitle.value=""; noticeBody.value="";
    });

    // ---------- tasks ë¦¬ìŠ¤ë„ˆ ----------
    function ownerUidForRead(){
      // ëª¨ë‘ ê´€ë¦¬ì ê³„ì •ì˜ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œ(ê³µê°œ/ë¹„ë¡œê·¸ì¸ë„ ë™ì¼)
      return ADMIN_UID;
    }
    function col(cat){
      // í•­ìƒ ê´€ë¦¬ì ê³„ì •ì˜ ë¬¸ì„œë¥¼ ì½ì–´ì˜´
      const uid = ownerUidForRead();
      return db.collection("users").doc(uid).collection("tasks").doc(cat).collection("items");
    }
    function writeCol(cat){
      // ì“°ê¸°ëŠ” ê´€ë¦¬ì ë³¸ì¸ ë¬¸ì„œë§Œ
      const uid = currentUser?.uid || "";
      return db.collection("users").doc(uid).collection("tasks").doc(cat).collection("items");
    }

    function startTaskListeners(){
      ["exam","perf","home"].forEach(cat=>{
        if(unsub[cat]) unsub[cat]();
        unsub[cat] = col(cat).orderBy("dueStart","asc").onSnapshot(snap=>{
          const arr=[]; snap.forEach(d=>arr.push({id:d.id, ...d.data()}));
          renderTasks(cat, arr);
        });
      });
      bindForms();
      restoreDrafts();
    }

    // ---------- ë Œë” ----------
    function renderTasks(cat, items){
      const ul = lists[cat];
      ul.innerHTML="";
      if(items.length===0){ empties[cat].style.display=""; return;}
      empties[cat].style.display="none";

      for(const it of items){
        const li = document.createElement("li");
        li.className="task";
        const badge = dBadge(it.dueStart, it.dueEnd);
        const period = periodText(it.startPeriod, it.endPeriod);
        const dateLine = `${it.dueStart ? it.dueStart : ""}${it.dueEnd ? " ~ "+it.dueEnd : ""}${period? " Â· "+period:""}`;

        li.innerHTML = `
          <div class="task-main">
            <div class="task-top">
              <b class="task-title">${esc(it.subj||"")}</b>
              ${badge}
            </div>
            <div class="task-text">${esc(it.text||"")}</div>
            <div class="task-date">ğŸ“… ${esc(dateLine)}</div>
            ${it.detail ? `<pre class="task-detail">${esc(it.detail)}</pre>` : ""}
          </div>
          <div class="actions" style="display:${isAdmin?'flex':'none'}">
            <button class="btn ghost" data-act="edit">ìˆ˜ì •</button>
            <button class="btn ghost danger" data-act="del">ì‚­ì œ</button>
          </div>
        `;

        li.addEventListener("click", async (e)=>{
          const act = e.target?.getAttribute?.("data-act");
          if(!act) return;
          if(!isAdmin) return toast("ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");

          if(act==="del"){
            if(!confirm("ì‚­ì œí• ê¹Œìš”?")) return;
            await writeCol(cat).doc(it.id).delete();
          }else{
            // ê°„í¸ ìˆ˜ì •(í”„ë¡¬í”„íŠ¸)
            const subj = prompt("ê³¼ëª©", it.subj||""); if(subj===null) return;
            const text = prompt("ë‚´ìš©", it.text||""); if(text===null) return;
            const start= prompt("ì‹œì‘ì¼(YYYY-MM-DD)", it.dueStart||""); if(start===null) return;
            const end  = prompt("ì¢…ë£Œì¼(YYYY-MM-DD, ë¹ˆì¹¸ í—ˆìš©)", it.dueEnd||""); if(end===null) return;
            const sp   = prompt("ì‹œì‘ êµì‹œ(ì˜ˆ: 1êµì‹œ, ë¹ˆì¹¸ ê°€ëŠ¥)", it.startPeriod||""); if(sp===null) return;
            const ep   = prompt("ë êµì‹œ(ì˜ˆ: 2êµì‹œ, ë¹ˆì¹¸ ê°€ëŠ¥)", it.endPeriod||""); if(ep===null) return;
            const det  = prompt("ìƒì„¸ ë‚´ìš©(ë¹ˆì¹¸ ê°€ëŠ¥)", it.detail||""); if(det===null) return;

            await writeCol(cat).doc(it.id).set({
              subj: subj.trim(),
              text: text.trim(),
              dueStart: start.trim() || "",
              dueEnd: (end||"").trim(),
              startPeriod: sp.trim() || "",
              endPeriod: ep.trim() || "",
              detail: det || "",
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            },{merge:true});
          }
        });

        ul.appendChild(li);
      }
    }

    // ---------- í¼ ë°”ì¸ë”© & ì„ì‹œì €ì¥ ----------
    function bindForms(){
      Object.entries(forms).forEach(([cat, form])=>{
        const subj   = $(".subj", form);
        const text   = $(".text", form);
        const start  = $(".start", form);
        const end    = $(".end", form);
        const startp = $(".startp", form);
        const endp   = $(".endp", form);
        const detail = $(".detail", form);
        const addBtn = $(".add", form);

        // ì…ë ¥ ë³€ê²½ ì‹œ ì„ì‹œì €ì¥
        form.addEventListener("input", ()=>{
          const data = {
            subj: subj.value, text: text.value, start: start.value, end: end.value,
            startp: startp.value, endp: endp.value, detail: detail.value
          };
          localStorage.setItem(`draft:${cat}`, JSON.stringify(data));
        });

        addBtn.onclick = async ()=>{
          if(!isAdmin) return toast("ê´€ë¦¬ìë§Œ ì¶”ê°€í•  ìˆ˜ ìˆì–´ìš”.");
          const s = (subj.value||"").trim();
          const t = (text.value||"").trim();
          const ds= (start.value||"").trim();
          const de= (end.value||"").trim();
          if(!s || !t || !ds){ subj.focus(); return; }

          await writeCol(cat).add({
            subj:s, text:t,
            dueStart: ds, dueEnd: de,
            startPeriod: startp.value||"",
            endPeriod: endp.value||"",
            detail: detail.value||"",
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });

          // ì…ë ¥ê°’ ìœ ì§€ ì›í•˜ë©´ ì§€ìš°ì§€ ë§ˆ
          subj.value=""; text.value=""; start.value=""; end.value="";
          startp.value=""; endp.value=""; detail.value="";
          localStorage.removeItem(`draft:${cat}`);
        };
      });
    }

    function restoreDrafts(){
      Object.entries(forms).forEach(([cat, form])=>{
        const raw = localStorage.getItem(`draft:${cat}`);
        if(!raw) return;
        try{
          const d = JSON.parse(raw);
          $(".subj", form).value   = d.subj||"";
          $(".text", form).value   = d.text||"";
          $(".start", form).value  = d.start||"";
          $(".end", form).value    = d.end||"";
          $(".startp", form).value = d.startp||"";
          $(".endp", form).value   = d.endp||"";
          $(".detail", form).value = d.detail||"";
        }catch{}
      });
    }

    // ---------- ë“œë¡­ë‹¤ìš´ ê°€ë ¤ì§ ë°©ì§€ ----------
    // (ë¶€ëª¨ì— overflow ìˆ¨ê¹€ì´ ì—†ë„ë¡ í•˜ê³ , select-wrapì— z-index)
    // CSSì—ì„œ ì²˜ë¦¬í–ˆì§€ë§Œ í˜¹ì‹œ ëª¨ë¥¼ ë ˆì´ì•„ì›ƒ ë²„ê·¸ ë°©ì§€
    $$(".select").forEach(el=>{
      el.addEventListener("mousedown", ()=> el.style.zIndex = 5 );
      el.addEventListener("blur",     ()=> el.style.zIndex = "" );
      el.addEventListener("change",   ()=> el.style.zIndex = "" );
    });

    // ---------- ì¡°ìš©í•œ 1ë¶„ ìƒˆë¡œê³ ì¹¨ (ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶©ë¶„í•˜ì§€ë§Œ ìœ ì§€) ----------
    setInterval(()=>{ if(!document.hidden){ /* onSnapshotë¡œ ì¶©ë¶„ */ } }, 60000);
  </script>
</body>
</html>
